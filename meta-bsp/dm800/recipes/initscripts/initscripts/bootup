progress() {
	[ -f /proc/progress ] && echo $1 >/proc/progress
}

progress 10

PID=
[ -f /etc/fscking.raw ] && [ -c /dev/dbox/oled0 ] && (
	(sleep 10; cat /etc/fscking.raw >/dev/dbox/oled0; sleep 1d) &
	PID=$!
)
mount -at nonfs,nosmbfs,noncpfs,nocifs
[ -n "$PID" ] && kill $PID

progress 14

swapon -a

progress 15

[ -b /dev/sda ] && (
	# sleep after 10min
	hdparm -S120 /dev/sda
	# acoustic management
	hdparm -M128 /dev/sda
)

progress 18

for mod in dreambox_keyboard bcm7401; do
	modprobe $mod
done

progress 19

[ -f /etc/videomode ] && cat /etc/videomode >/proc/stb/video/videomode

progress 20

# we must wait until udev has created the video device
(
[ -f /etc/dropbear/dropbear_rsa_host_key ] && LOGO=bootlogo || LOGO=bootlogo_wait
udevadm settle --exit-if-exists=/dev/dvb/adapter0/video0
showiframe /usr/share/dreambox-bootlogo/$LOGO.mvi
) &

progress 21

[ -f /etc/hostname ] && hostname -F /etc/hostname

progress 23

[ -f "/etc/sysctl.conf" ] && sysctl -p /etc/sysctl.conf

progress 25
